<html>
<head>
    <meta charset="utf-8">
    <link href="src/output.css" rel="stylesheet">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.8/dist/cdn.min.js"></script>
</head>
<body class="bg-gray-900" x-data="updateWord">
    <div class="flex flex-col items-center relative" x-init="getWord()">
        <div class="flex flex-col mt-5">
            <div class="relative">
                <template x-for="row in rows">
                    <div class="flex justify-center mt-1 gap-1">
                        <template x-for="(value, index) in cols">
                            <div class="w-14 h-14 flex justify-center items-center">
                                <template x-if="row === count">
                                    <div class="text-3xl font-bold text-white uppercase relative z-20" x-text="word[index]"></div>
                                </template>
                            </div>
                        </template>
                    </div>
                </template>
            </div>
            <div class="absolute top-0 mt-5 z-10">
                <template x-for="row in rows">
                    <div class="flex justify-center mt-1 gap-1">
                        <template x-for="(value, index) in cols">
                            <div class="border border-gray-500 w-14 h-14 flex justify-center items-center" :id="$id('word-'+ [row+1] +'-input')">
                                <div class="text-3xl font-bold text-white uppercase" x-text="buffer[row][index]"></div>
                            </div>
                        </template>
                    </div>
                </template>
            </div>
        </div>
        <div class="mt-8">
            <input class="border border-white text-white"
                   id="textInput"
                   type="text"
                   x-model="word"
                   maxlength="5">
        </div>
        <div class="bg-green-500 text-white p-4 my-4 rounded-md" x-show="checker">
            <span>You guessed the word</span>
        </div>
        <div class="bg-red-500 text-white p-4 my-4 rounded-md" x-show="outOfTries">
            <span>You ran out of tries</span>
        </div>

        <div class="my-4 flex flex-col items-center gap-1">
            <div class="flex gap-1">
                <div class="text-white text-xl font-semibold bg-zinc-500 w-12 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.q.window="console.log('q')"
                     x-text="'q'">
                </div>
                <div class="text-white text-xl font-semibold bg-zinc-500 w-12 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.w.window="console.log('w')"
                     x-text="'w'">
                </div>
                <div class="text-white text-xl font-semibold bg-zinc-500 w-12 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.e.window="console.log('e')"
                     x-text="'e'">
                </div>
                <div class="text-white text-xl font-semibold bg-zinc-500 w-12 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.r.window="console.log('r')"
                     x-text="'r'">
                </div>
                <div class="text-white text-xl font-semibold bg-zinc-500 w-12 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.t.window="console.log('t')"
                     x-text="'t'">
                </div>
                <div class="text-white text-xl font-semibold bg-zinc-500 w-12 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.y.window="console.log('y')"
                     x-text="'y'">
                </div>
                <div class="text-white text-xl font-semibold bg-zinc-500 w-12 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.u.window="console.log('u')"
                     x-text="'u'">
                </div>
                <div class="text-white text-xl font-semibold bg-zinc-500 w-12 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.i.window="console.log('i')"
                     x-text="'i'">
                </div>
                <div class="text-white text-xl font-semibold bg-zinc-500 w-12 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.o.window="console.log('o')"
                     x-text="'o'">
                </div>
                <div class="text-white text-xl font-semibold bg-zinc-500 w-12 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.p.window="console.log('p')"
                     x-text="'p'">
                </div>
            </div>
            <div class="flex gap-1">
                <div class="text-white text-xl font-semibold bg-zinc-500 w-12 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.a.window="console.log('a')"
                     x-text="'a'">
                </div>
                <div class="text-white text-xl font-semibold bg-zinc-500 w-12 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.s.window="console.log('s')"
                     x-text="'s'">
                </div>
                <div class="text-white text-xl font-semibold bg-zinc-500 w-12 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.d.window="console.log('d')"
                     x-text="'d'">
                </div>
                <div class="text-white text-xl font-semibold bg-zinc-500 w-12 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.f.window="console.log('f')"
                     x-text="'f'">
                </div>
                <div class="text-white text-xl font-semibold bg-zinc-500 w-12 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.g.window="console.log('g')"
                     x-text="'g'">
                </div>
                <div class="text-white text-xl font-semibold bg-zinc-500 w-12 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.h.window="console.log('h')"
                     x-text="'h'">
                </div>
                <div class="text-white text-xl font-semibold bg-zinc-500 w-12 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.j.window="console.log('j')"
                     x-text="'j'">
                </div>
                <div class="text-white text-xl font-semibold bg-zinc-500 w-12 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.k.window="console.log('k')"
                     x-text="'k'">
                </div>
                <div class="text-white text-xl font-semibold bg-zinc-500 w-12 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.l.window="console.log('l')"
                     x-text="'l'">
                </div>
            </div>
            <div class="flex gap-1">
                <div class="text-white text-sm font-semibold bg-zinc-500 w-20 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.enter.window="submitWord()" x-text="'enter'">
                </div>
                <div class="text-white text-xl font-semibold bg-zinc-500 w-12 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.z.window="console.log('z')"
                     x-text="'z'">
                </div>
                <div class="text-white text-xl font-semibold bg-zinc-500 w-12 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.x.window="console.log('x')"
                     x-text="'x'">
                </div>
                <div class="text-white text-xl font-semibold bg-zinc-500 w-12 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.c.window="console.log('c')"
                     x-text="'c'">
                </div>
                <div class="text-white text-xl font-semibold bg-zinc-500 w-12 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.v.window="console.log('v')"
                     x-text="'v'">
                </div>
                <div class="text-white text-xl font-semibold bg-zinc-500 w-12 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.b.window="console.log('b')"
                     x-text="'b'">
                </div>
                <div class="text-white text-xl font-semibold bg-zinc-500 w-12 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.n.window="console.log('n')"
                     x-text="'n'">
                </div>
                <div class="text-white text-xl font-semibold bg-zinc-500 w-12 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.m.window="console.log('m')"
                     x-text="'m'">
                </div>
                <div class="text-white text-sm font-semibold bg-zinc-500 w-20 h-16 rounded-md uppercase flex justify-center items-center"
                     x-text="'del'">
                </div>
            </div>
        </div>
    </div>
</body>
</html>

<script>
    document.addEventListener('alpine:init', () => {
        Alpine.data('updateWord', () => ({
            count: 0,
            word: [],
            buffer: [],
            rows: [0, 1, 2, 3, 4, 5],
            cols: [0, 1, 2, 3, 4],
            correctWord: ['kotka'],
            checker: false,
            outOfTries: false,

            submitWord() {
                if (this.word.length < 5) {
                    console.log('enter full word');
                } else {
                    this.count++;
                    this.buffer.push(this.word);

                    if (this.buffer[this.count-1] === this.correctWord[0]) {
                        this.checker = true;
                        document.getElementById('textInput').disabled = true;
                    }

                    if (this.count > 5 && this.buffer[this.count-1] !== this.correctWord[0]) {
                        this.outOfTries = true;
                        document.getElementById('textInput').disabled = true;
                    }

                    this.word = '';

                    this.checkWord();
                }
            },

            checkWord() {
                const correctWordArray = this.correctWord[0].split('');

                for (let i = 1; i <= 5; i++) {
                    document.getElementById('word-' + this.count + '-input-' + i).classList.add('bg-gray-500');
                    let filteredWord = correctWordArray.filter(value => this.buffer[this.count-1].split('').includes(value));
                    for (let j = 0; j < filteredWord.length; j++) {
                        if (this.correctWord[0][i - 1] === this.buffer[this.count - 1][i - 1]) {
                            if (this.buffer[this.count - 1][i - 1]) {
                                document.getElementById('word-' + this.count + '-input-' + i).classList.add('bg-green-500');
                            }
                        } else if (this.buffer[this.count - 1].split('')[i - 1] === filteredWord[j]) {
                            document.getElementById('word-' + this.count + '-input-' + i).classList.add('bg-yellow-500');
                        }
                    }
                }
            },

            async getWord() {
                try {
                    fetch('https://cheaderthecoder.github.io/5-Letter-words/words.json')
                        .then(res => res.json())
                        .then(data => {
                            this.correctWord.push(data.words[Math.floor(Math.random() * 5757)]);
                        })
                } catch (error) {
                    console.log(error.message);
                }

                console.log(this.correctWord);
            }
        }))
    })
</script>