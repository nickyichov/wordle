<html>
<head>
    <meta charset="utf-8">
    <link href="src/output.css" rel="stylesheet">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.8/dist/cdn.min.js"></script>
</head>
<body class="bg-gray-900 relative" x-data="updateWord"  @keypress="key = $event">
    <div class="flex flex-col items-center relative" x-init="getWord()">
        <div class="flex flex-col mt-5">
            <div class="relative">
                <template x-for="row in rows">
                    <div class="flex justify-center mt-1 gap-1">
                        <template x-for="(value, index) in cols">
                            <div class="w-14 h-14 flex justify-center items-center">
                                <template x-if="row === count">
                                    <div class="text-3xl font-bold text-white uppercase relative z-20" x-text="word[index]"></div>
                                </template>
                            </div>
                        </template>
                    </div>
                </template>
            </div>
            <div class="absolute top-0 mt-5 z-10">
                <template x-for="row in rows">
                    <div class="flex justify-center mt-1 gap-1">
                        <template x-for="(value, index) in cols">
                            <div class="border border-gray-500 w-14 h-14 flex justify-center items-center" :id="$id('word-'+ [row+1] +'-input')">
                                <div class="text-3xl font-bold text-white uppercase" x-text="buffer[row][index]"></div>
                            </div>
                        </template>
                    </div>
                </template>
            </div>
        </div>

        <div id="keyboard" class="my-4 flex flex-col items-center gap-1">
            <div class="flex gap-1">
                <div id="113" class="letter"
                     @keydown.q.window="word.length < 5 ? word.push('q') : ''"
                     x-text="'q'">
                </div>
                <div id="119" class="letter"
                     @keydown.w.window="word.length < 5 ? word.push('w'): ''"
                     x-text="'w'">
                </div>
                <div id="101" class="letter"
                     @keydown.e.window="word.length < 5 ? word.push('e') : ''"
                     x-text="'e'">
                </div>
                <div id="114" class="letter"
                     @keydown.r.window="word.length < 5 ? word.push('r') : ''"
                     x-text="'r'">
                </div>
                <div id="116" class="letter"
                     @keydown.t.window="word.length < 5 ? word.push('t') : ''"
                     x-text="'t'">
                </div>
                <div id="121" class="letter"
                     @keydown.y.window="word.length < 5 ? word.push('y') : ''"
                     x-text="'y'">
                </div>
                <div id="117" class="letter"
                     @keydown.u.window="word.length < 5 ? word.push('u') : ''"
                     x-text="'u'">
                </div>
                <div id="105"class="letter"
                     @keydown.i.window="word.length < 5 ? word.push('i') : ''"
                     x-text="'i'">
                </div>
                <div id="111" class="letter"
                     @keydown.o.window="word.length < 5 ? word.push('o') : ''"
                     x-text="'o'">
                </div>
                <div id="112" class="letter"
                     @keydown.p.window="word.length < 5 ? word.push('p') : ''"
                     x-text="'p'">
                </div>
            </div>
            <div class="flex gap-1">
                <div id="97" class="letter"
                     @keydown.a.window="word.length < 5 ? word.push('a') : ''"
                     x-text="'a'">
                </div>
                <div id="115" class="letter"
                     @keydown.s.window="word.length < 5 ? word.push('s') : ''"
                     x-text="'s'">
                </div>
                <div id="100" class="letter"
                     @keydown.d.window="word.length < 5 ? word.push('d') : ''"
                     x-text="'d'">
                </div>
                <div id="102" class="letter"
                     @keydown.f.window="word.length < 5 ? word.push('f') : ''"
                     x-text="'f'">
                </div>
                <div id="103" class="letter"
                     @keydown.g.window="word.length < 5 ? word.push('g') : ''"
                     x-text="'g'">
                </div>
                <div id="104" class="letter"
                     @keydown.h.window="word.length < 5 ? word.push('h') : ''"
                     x-text="'h'">
                </div>
                <div id="106" class="letter"
                     @keydown.j.window="word.length < 5 ? word.push('j') : ''"
                     x-text="'j'">
                </div>
                <div id="107" class="letter"
                     @keydown.k.window="word.length < 5 ? word.push('k') : ''"
                     x-text="'k'">
                </div>
                <div id="108" class="letter"
                     @keydown.l.window="word.length < 5 ? word.push('l') : ''"
                     x-text="'l'">
                </div>
            </div>
            <div class="flex gap-1">
                <div id="13" class="text-white text-sm font-semibold bg-zinc-500 w-20 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.enter.window="submitWord()" x-text="'enter'">
                </div>
                <div id="122" class="letter"
                     @keydown.z.window="word.length < 5 ? word.push('z') : ''"
                     x-text="'z'">
                </div>
                <div id="120" class="letter"
                     @keydown.x.window="word.length < 5 ? word.push('x') : ''"
                     x-text="'x'">
                </div>
                <div id="99" class="letter"
                     @keydown.c.window="word.length < 5 ? word.push('c') : ''"
                     x-text="'c'">
                </div>
                <div id="118" class="letter"
                     @keydown.v.window="word.length < 5 ? word.push('v') : ''"
                     x-text="'v'">
                </div>
                <div id="98" class="letter"
                     @keydown.b.window="word.length < 5 ? word.push('b') : ''"
                     x-text="'b'">
                </div>
                <div id="110" class="letter"
                     @keydown.n.window="word.length < 5 ? word.push('n') : ''"
                     x-text="'n'">
                </div>
                <div id="109" class="letter"
                     @keydown.m.window="word.length < 5 ? word.push('m') : ''"
                     x-text="'m'">
                </div>
                <div class="text-white text-sm font-semibold bg-zinc-500 w-20 h-16 rounded-md uppercase flex justify-center items-center"
                     x-on:click="word.pop()"
                     x-text="'del'">
                </div>
            </div>
        </div>
    </div>
    <template x-if="checker || outOfTries">
        <div class="absolute w-full h-screen bg-gray-700/80 top-0 z-50">
            <div class="flex justify-center items-center h-8/12">
                <div class="bg-gray-200 opacity-full w-[40rem] h-96">
                    <div class="flex justify-around items-center h-full flex-col gap-4" x-show="checker">
                        <div>
                            <span class="text-2xl font-semibold">Congratulations you have guessed the word!</span>
                        </div>
                        <button class="bg-green-500 py-4 px-8 text-white font-bold rounded-full" x-on:click="window.location.reload()">Play again</button>
                    </div>
                    <div class="flex justify-around items-center h-full flex-col gap-4" x-show="outOfTries">
                        <div class="flex flex-col gap-8 items-center">
                            <span class="text-2xl font-semibold">You ran out of tries</span>
                            <div class="flex flex-col gap-4 items-center">
                                <span class="text-2xl" x-text="'The correct word is'"></span>
                                <div class="flex">
                                    <template x-for="correctLetters in correctWord[0]">
                                        <span class="border border-gray-500 bg-green-500 text-white w-12 h-12 text-4xl text-center uppercase mx-0.5"
                                              x-text="correctLetters"></span>
                                    </template>
                                </div>
                            </div>
                        </div>
                        <button class="bg-green-500 py-4 px-8 text-white font-bold rounded-full" x-on:click="window.location.reload()">Play again</button>
                    </div>
                </div>
            </div>
        </div>
    </template>
</body>
</html>

<script>
    document.addEventListener('alpine:init', () => {
        Alpine.data('updateWord', () => ({
            count: 0,
            word: [],
            buffer: [],
            rows: [0, 1, 2, 3, 4, 5],
            cols: [0, 1, 2, 3, 4],
            correctWord: [],
            checker: false,
            outOfTries: false,
            key: 0,

            init() {
                Alpine.effect(() => {
                    const currentKey = this.key.keyCode;
                    const currentId = this.key.keyCode;

                    const letters = document.getElementById(currentId);
                    document.body.addEventListener("keydown", (e)=>{
                        if (e.keyCode === currentKey - 32) {
                            letters.style.background = '#52525b';
                            letters.style.border = 'solid 2px'
                        }
                    })
                    document.addEventListener("keyup", (e)=>{
                        if (e.keyCode === currentKey - 32) {
                            letters.removeAttribute('style');
                        }
                    })
                })
            },

            submitWord() {
                if (this.word.length < 5) {
                    console.log('enter full word');
                } else {
                    this.count++;
                    this.buffer.push(this.word.toString().replace(/,/g, ''));

                    if (this.buffer[this.count-1] === this.correctWord[0]) {
                        this.checker = true;
                        document.getElementById('keyboard').setAttribute('x-ignore', "");
                    }

                    if (this.count > 5 && this.buffer[this.count-1] !== this.correctWord[0]) {
                        this.outOfTries = true;
                    }

                    this.word = [];

                    this.checkWord();
                }
            },

            checkWord() {
                const correctWordArray = this.correctWord[0].split('');

                for (let i = 1; i <= 5; i++) {
                    document.getElementById('word-' + this.count + '-input-' + i).classList.add('bg-gray-500');
                    let filteredWord = correctWordArray.filter(value => this.buffer[this.count-1].split('').includes(value));
                    for (let j = 0; j < filteredWord.length; j++) {
                        if (this.correctWord[0][i - 1] === this.buffer[this.count - 1][i - 1]) {
                            if (this.buffer[this.count - 1][i - 1]) {
                                document.getElementById('word-' + this.count + '-input-' + i).classList.add('bg-green-500');
                            }
                        } else if (this.buffer[this.count - 1].split('')[i - 1] === filteredWord[j]) {
                            document.getElementById('word-' + this.count + '-input-' + i).classList.add('bg-yellow-500');
                        }
                    }
                }
            },

            async getWord() {
                try {
                    fetch('https://cheaderthecoder.github.io/5-Letter-words/words.json')
                        .then(res => res.json())
                        .then(data => {
                            this.correctWord.push(data.words[Math.floor(Math.random() * 5757)]);
                        })
                } catch (error) {
                    console.log(error.message);
                }
            }
        }))
    })
</script>