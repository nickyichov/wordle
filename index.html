<html>
<head>
    <meta charset="utf-8">
    <link href="src/output.css" rel="stylesheet">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.8/dist/cdn.min.js"></script>
</head>
<body class="bg-gray-900" x-data="updateWord">
    <div class="flex flex-col items-center relative" x-init="getWord()">
        <div class="flex flex-col mt-5">
            <div class="relative">
                <template x-for="row in rows">
                    <div class="flex justify-center mt-1 gap-1">
                        <template x-for="(value, index) in cols">
                            <div class="w-14 h-14 flex justify-center items-center">
                                <template x-if="row === count">
                                    <div class="text-3xl font-bold text-white uppercase relative z-20" x-text="word[index]"></div>
                                </template>
                            </div>
                        </template>
                    </div>
                </template>
            </div>
            <div class="absolute top-0 mt-5 z-10">
                <template x-for="row in rows">
                    <div class="flex justify-center mt-1 gap-1">
                        <template x-for="(value, index) in cols">
                            <div class="border border-gray-500 w-14 h-14 flex justify-center items-center" :id="$id('word-'+ [row+1] +'-input')">
                                <div class="text-3xl font-bold text-white uppercase" x-text="buffer[row][index]"></div>
                            </div>
                        </template>
                    </div>
                </template>
            </div>
        </div>
        <div class="mt-8">
            <input class="border border-white text-white"
                   id="textInput"
                   type="text"
                   x-model="word"
                   maxlength="5">
        </div>
        <div @keydown.enter.window="submitWord()"></div>
        <div class="bg-green-500 text-white p-4 my-4 rounded-md" x-show="checker">
            <span>You guessed the word</span>
        </div>
        <div class="bg-red-500 text-white p-4 my-4 rounded-md" x-show="outOfTries">
            <span>You ran out of tries</span>
        </div>
    </div>
</body>
</html>

<script>
    document.addEventListener('alpine:init', () => {
        Alpine.data('updateWord', () => ({
            count: 0,
            word: [],
            buffer: [],
            rows: [0, 1, 2, 3, 4, 5],
            cols: [0, 1, 2, 3, 4],
            correctWord: ['kotka'],
            checker: false,
            outOfTries: false,

            submitWord() {
                if (this.word.length < 5) {
                    console.log('enter full word');
                } else {
                    this.count++;
                    this.buffer.push(this.word);

                    if (this.buffer[this.count-1] === this.correctWord[0]) {
                        this.checker = true;
                        document.getElementById('textInput').disabled = true;
                    }

                    if (this.count > 5 && this.buffer[this.count-1] !== this.correctWord[0]) {
                        this.outOfTries = true;
                        document.getElementById('textInput').disabled = true;
                    }

                    this.word = '';

                    this.checkWord();
                }
            },

            checkWord() {
                const correctWordArray = this.correctWord[0].split('');

                for (let i = 1; i <= 5; i++) {
                    document.getElementById('word-' + this.count + '-input-' + i).classList.add('bg-gray-500');
                    let filteredWord = correctWordArray.filter(value => this.buffer[this.count-1].split('').includes(value));
                    for (let j = 0; j < filteredWord.length; j++) {
                        if (this.correctWord[0][i - 1] === this.buffer[this.count - 1][i - 1]) {
                            if (this.buffer[this.count - 1][i - 1]) {
                                document.getElementById('word-' + this.count + '-input-' + i).classList.add('bg-green-500');
                            }
                        } else if (this.buffer[this.count - 1].split('')[i - 1] === filteredWord[j]) {
                            document.getElementById('word-' + this.count + '-input-' + i).classList.add('bg-yellow-500');
                        }
                    }
                }
            },

            async getWord() {
                try {
                    fetch('https://cheaderthecoder.github.io/5-Letter-words/words.json')
                        .then(res => res.json())
                        .then(data => {
                            this.correctWord.push(data.words[Math.floor(Math.random() * 5757)]);
                        })
                } catch (error) {
                    console.log(error.message);
                }

                console.log(this.correctWord);
            }
        }))
    })
</script>