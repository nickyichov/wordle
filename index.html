<html>
<head>
    <meta charset="utf-8">
    <link href="src/output.css" rel="stylesheet">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.8/dist/cdn.min.js"></script>
</head>
<body class="bg-gray-900" x-data="updateWord"  @keypress="key = $event">
    <div class="flex flex-col items-center relative" x-init="getWord()">
        <div class="flex flex-col mt-5">
            <div class="relative">
                <template x-for="row in rows">
                    <div class="flex justify-center mt-1 gap-1">
                        <template x-for="(value, index) in cols">
                            <div class="w-14 h-14 flex justify-center items-center">
                                <template x-if="row === count">
                                    <div class="text-3xl font-bold text-white uppercase relative z-20" x-text="word[index]"></div>
                                </template>
                            </div>
                        </template>
                    </div>
                </template>
            </div>
            <div class="absolute top-0 mt-5 z-10">
                <template x-for="row in rows">
                    <div class="flex justify-center mt-1 gap-1">
                        <template x-for="(value, index) in cols">
                            <div class="border border-gray-500 w-14 h-14 flex justify-center items-center" :id="$id('word-'+ [row+1] +'-input')">
                                <div class="text-3xl font-bold text-white uppercase" x-text="buffer[row][index]"></div>
                            </div>
                        </template>
                    </div>
                </template>
            </div>
        </div>

        <div class="bg-green-500 text-white p-4 my-4 rounded-md" x-show="checker">
            <span>You guessed the word</span>
        </div>
        <div class="bg-red-500 text-white p-4 my-4 rounded-md" x-show="outOfTries">
            <span>You ran out of tries</span>
        </div>

        <div id="keyboard" class="my-4 flex flex-col items-center gap-1">
            <div class="flex gap-1">
                <div class="letter"
                     @keydown.q.window="word.length < 5 ? word.push('q') : ''"
                     x-text="'q'">
                </div>
                <div class="letter"
                     @keydown.w.window="word.length < 5 ? word.push('w'): ''"
                     x-text="'w'">
                </div>
                <div class="letter"
                     @keydown.e.window="word.length < 5 ? word.push('e') : ''"
                     x-text="'e'">
                </div>
                <div class="letter"
                     @keydown.r.window="word.length < 5 ? word.push('r') : ''"
                     x-text="'r'">
                </div>
                <div class="letter"
                     @keydown.t.window="word.length < 5 ? word.push('t') : ''"
                     x-text="'t'">
                </div>
                <div class="letter"
                     @keydown.y.window="word.length < 5 ? word.push('y') : ''"
                     x-text="'y'">
                </div>
                <div class="letter"
                     @keydown.u.window="word.length < 5 ? word.push('u') : ''"
                     x-text="'u'">
                </div>
                <div class="letter"
                     @keydown.i.window="word.length < 5 ? word.push('i') : ''"
                     x-text="'i'">
                </div>
                <div class="letter"
                     @keydown.o.window="word.length < 5 ? word.push('o') : ''"
                     x-text="'o'">
                </div>
                <div class="letter"
                     @keydown.p.window="word.length < 5 ? word.push('p') : ''"
                     x-text="'p'">
                </div>
            </div>
            <div class="flex gap-1">
                <div class="letter"
                     @keydown.a.window="word.length < 5 ? word.push('a') : ''"
                     x-text="'a'">
                </div>
                <div class="letter"
                     @keydown.s.window="word.length < 5 ? word.push('s') : ''"
                     x-text="'s'">
                </div>
                <div class="letter"
                     @keydown.d.window="word.length < 5 ? word.push('d') : ''"
                     x-text="'d'">
                </div>
                <div class="letter"
                     @keydown.f.window="word.length < 5 ? word.push('f') : ''"
                     x-text="'f'">
                </div>
                <div class="letter"
                     @keydown.g.window="word.length < 5 ? word.push('g') : ''"
                     x-text="'g'">
                </div>
                <div class="letter"
                     @keydown.h.window="word.length < 5 ? word.push('h') : ''"
                     x-text="'h'">
                </div>
                <div class="letter"
                     @keydown.j.window="word.length < 5 ? word.push('j') : ''"
                     x-text="'j'">
                </div>
                <div class="letter"
                     @keydown.k.window="word.length < 5 ? word.push('k') : ''"
                     x-text="'k'">
                </div>
                <div class="letter"
                     @keydown.l.window="word.length < 5 ? word.push('l') : ''"
                     x-text="'l'">
                </div>
            </div>
            <div class="flex gap-1">
                <div class="text-white text-sm font-semibold bg-zinc-500 w-20 h-16 rounded-md uppercase flex justify-center items-center"
                     @keydown.enter.window="submitWord()" x-text="'enter'">
                </div>
                <div class="letter"
                     @keydown.z.window="word.length < 5 ? word.push('z') : ''"
                     x-text="'z'">
                </div>
                <div class="letter"
                     @keydown.x.window="word.length < 5 ? word.push('x') : ''"
                     x-text="'x'">
                </div>
                <div class="letter"
                     @keydown.c.window="word.length < 5 ? word.push('c') : ''"
                     x-text="'c'">
                </div>
                <div class="letter"
                     @keydown.v.window="word.length < 5 ? word.push('v') : ''"
                     x-text="'v'">
                </div>
                <div class="letter"
                     @keydown.b.window="word.length < 5 ? word.push('b') : ''"
                     x-text="'b'">
                </div>
                <div class="letter"
                     @keydown.n.window="word.length < 5 ? word.push('n') : ''"
                     x-text="'n'">
                </div>
                <div class="letter"
                     @keydown.m.window="word.length < 5 ? word.push('m') : ''"
                     x-text="'m'">
                </div>
                <div class="text-white text-sm font-semibold bg-zinc-500 w-20 h-16 rounded-md uppercase flex justify-center items-center"
                     x-on:click="console.log(word.pop())"
                     x-text="'del'">
                </div>
            </div>
        </div>
    </div>
</body>
</html>

<script>
    document.addEventListener('alpine:init', () => {
        Alpine.data('updateWord', () => ({
            count: 0,
            word: [],
            buffer: [],
            rows: [0, 1, 2, 3, 4, 5],
            cols: [0, 1, 2, 3, 4],
            correctWord: ['kotka'],
            checker: false,
            outOfTries: false,
            key: 0,

            init() {
                Alpine.effect(() => {
                    const currentKey = this.key.keyCode;

                    const letters = document.getElementsByClassName("letter");
                    document.body.addEventListener("keydown", (e)=>{
                        for (let i = 0; i < letters.length; i++) {
                            if(e.keyCode === currentKey-32) {
                                letters[i].style.background = 'red';
                            }
                        }
                    })
                    document.addEventListener("keyup", (e)=>{
                        for (let i = 0; i < letters.length; i++) {
                            if(e.keyCode === currentKey-32) {
                                letters[i].removeAttribute('style');
                            }
                        }
                    })
                })
            },

            submitWord() {
                if (this.word.length < 5) {
                    console.log('enter full word');
                } else {
                    this.count++;
                    this.buffer.push(this.word.toString().replace(/,/g, ''));

                    if (this.buffer[this.count-1] === this.correctWord[0]) {
                        this.checker = true;
                        document.getElementById('keyboard').setAttribute('x-ignore', "");
                    }

                    if (this.count > 5 && this.buffer[this.count-1] !== this.correctWord[0]) {
                        this.outOfTries = true;
                    }

                    console.log(this.word)

                    this.word = [];

                    this.checkWord();
                }
            },

            checkWord() {
                const correctWordArray = this.correctWord[0].split('');

                for (let i = 1; i <= 5; i++) {
                    document.getElementById('word-' + this.count + '-input-' + i).classList.add('bg-gray-500');
                    let filteredWord = correctWordArray.filter(value => this.buffer[this.count-1].split('').includes(value));
                    for (let j = 0; j < filteredWord.length; j++) {
                        if (this.correctWord[0][i - 1] === this.buffer[this.count - 1][i - 1]) {
                            if (this.buffer[this.count - 1][i - 1]) {
                                document.getElementById('word-' + this.count + '-input-' + i).classList.add('bg-green-500');
                            }
                        } else if (this.buffer[this.count - 1].split('')[i - 1] === filteredWord[j]) {
                            document.getElementById('word-' + this.count + '-input-' + i).classList.add('bg-yellow-500');
                        }
                    }
                }
            },

            async getWord() {
                try {
                    fetch('https://cheaderthecoder.github.io/5-Letter-words/words.json')
                        .then(res => res.json())
                        .then(data => {
                            this.correctWord.push(data.words[Math.floor(Math.random() * 5757)]);
                        })
                } catch (error) {
                    console.log(error.message);
                }

                console.log(this.correctWord);
            }
        }))
    })
</script>